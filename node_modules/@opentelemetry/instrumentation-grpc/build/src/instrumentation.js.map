{"version":3,"file":"instrumentation.js","sourceRoot":"","sources":["../../src/instrumentation.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;GAcG;;;AAIH,uCAAoC;AACpC,iCAAmD;AACnD,uCAAkD;AAIlD,6EAA6E;AAChE,QAAA,cAAc,GAAG,gBAAgB,CAAC;AAE/C,MAAa,mBAAmB;IAQ9B,YACY,UAA6D,EAAE;QAA/D,YAAO,GAAP,OAAO,CAAwD;QAL3D,wBAAmB,GACjC,qCAAqC,CAAC;QACxB,2BAAsB,GAAW,iBAAO,CAAC;QAKvD,IAAI,CAAC,sBAAsB,GAAG,IAAI,+BAAqB,CACrD,OAAO,EACP,IAAI,CAAC,mBAAmB,EACxB,IAAI,CAAC,sBAAsB,CAC5B,CAAC;QACF,IAAI,CAAC,0BAA0B,GAAG,IAAI,gCAAyB,CAC7D,OAAO,EACP,IAAI,CAAC,mBAAmB,EACxB,IAAI,CAAC,sBAAsB,CAC5B,CAAC;IACJ,CAAC;IAEM,SAAS,CACd,SAA4D,EAAE;QAE9D,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;QACzC,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACpD,IAAI,CAAC,0BAA0B,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAC1D,CAAC;IAED;;;;OAIG;IACI,SAAS;QACd,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAED,IAAI;QACF,mEAAmE;QACnE,OAAO;IACT,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,sBAAsB,CAAC,MAAM,EAAE,CAAC;QACrC,IAAI,CAAC,0BAA0B,CAAC,MAAM,EAAE,CAAC;IAC3C,CAAC;IAED,OAAO;QACL,IAAI,CAAC,sBAAsB,CAAC,OAAO,EAAE,CAAC;QACtC,IAAI,CAAC,0BAA0B,CAAC,OAAO,EAAE,CAAC;IAC5C,CAAC;IAED;;;OAGG;IACI,gBAAgB,CAAC,aAA4B;QAClD,IAAI,CAAC,sBAAsB,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;QAC5D,IAAI,CAAC,0BAA0B,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;IAClE,CAAC;IAED;;;OAGG;IACI,iBAAiB,CAAC,cAAkC;QACzD,IAAI,CAAC,sBAAsB,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;QAC9D,IAAI,CAAC,0BAA0B,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;IACpE,CAAC;CACF;AAxED,kDAwEC","sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InstrumentationConfig } from '@opentelemetry/instrumentation';\nimport { GrpcInstrumentationConfig } from './types';\nimport { VERSION } from './version';\nimport { GrpcNativeInstrumentation } from './grpc';\nimport { GrpcJsInstrumentation } from './grpc-js';\nimport * as api from '@opentelemetry/api';\nimport { MeterProvider } from '@opentelemetry/api-metrics';\n\n/** The metadata key under which span context is stored as a binary value. */\nexport const GRPC_TRACE_KEY = 'grpc-trace-bin';\n\nexport class GrpcInstrumentation {\n  private _grpcNativeInstrumentation: GrpcNativeInstrumentation;\n  private _grpcJsInstrumentation: GrpcJsInstrumentation;\n\n  public readonly instrumentationName: string =\n    '@opentelemetry/instrumentation-grpc';\n  public readonly instrumentationVersion: string = VERSION;\n\n  constructor(\n    protected _config: GrpcInstrumentationConfig & InstrumentationConfig = {}\n  ) {\n    this._grpcJsInstrumentation = new GrpcJsInstrumentation(\n      _config,\n      this.instrumentationName,\n      this.instrumentationVersion\n    );\n    this._grpcNativeInstrumentation = new GrpcNativeInstrumentation(\n      _config,\n      this.instrumentationName,\n      this.instrumentationVersion\n    );\n  }\n\n  public setConfig(\n    config: GrpcInstrumentationConfig & InstrumentationConfig = {}\n  ) {\n    this._config = Object.assign({}, config);\n    this._grpcJsInstrumentation.setConfig(this._config);\n    this._grpcNativeInstrumentation.setConfig(this._config);\n  }\n\n  /**\n   * @internal\n   * Public reference to the protected BaseInstrumentation `_config` instance to be used by this\n   * plugin's external helper functions\n   */\n  public getConfig() {\n    return this._config;\n  }\n\n  init() {\n    // sub instrumentations will already be init when constructing them\n    return;\n  }\n\n  enable() {\n    this._grpcJsInstrumentation.enable();\n    this._grpcNativeInstrumentation.enable();\n  }\n\n  disable() {\n    this._grpcJsInstrumentation.disable();\n    this._grpcNativeInstrumentation.disable();\n  }\n\n  /**\n   * Sets MeterProvider to this plugin\n   * @param meterProvider\n   */\n  public setMeterProvider(meterProvider: MeterProvider) {\n    this._grpcJsInstrumentation.setMeterProvider(meterProvider);\n    this._grpcNativeInstrumentation.setMeterProvider(meterProvider);\n  }\n\n  /**\n   * Sets TraceProvider to this plugin\n   * @param tracerProvider\n   */\n  public setTracerProvider(tracerProvider: api.TracerProvider) {\n    this._grpcJsInstrumentation.setTracerProvider(tracerProvider);\n    this._grpcNativeInstrumentation.setTracerProvider(tracerProvider);\n  }\n}\n"]}